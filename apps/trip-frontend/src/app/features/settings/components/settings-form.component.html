<form [formGroup]="form" (ngSubmit)="onSave()" class="edit-form">
  <!-- Preferences Section -->
  <div class="form-section">
    <h3 class="section-title">Preferences</h3>
    <div class="form-grid">
      <!-- Timezone -->
      <div class="form-field">
        <label class="field-label" for="timezone">Timezone</label>
        <select
          id="timezone"
          formControlName="timezone"
          class="form-input"
          [class.error]="isFieldInvalid('timezone')">
          <option value="" disabled>Select a timezone</option>
          @for (timezone of timezones; track timezone.value) {
            <option [value]="timezone.value">{{ timezone.label }}</option>
          }
        </select>
        @if (form.get('timezone')?.errors?.['required']) {
          <p class="field-error">Timezone is required</p>
        }
        @if (form.get('timezone')?.errors?.['zod']; as zodError) {
          <p class="field-error">{{ zodError }}</p>
        }
      </div>

      <!-- Distance Units -->
      <div class="form-field">
        <label class="field-label" for="distanceUnit">Distance Units</label>
        <select id="distanceUnit" formControlName="distanceUnit" class="form-input">
          <option value="KILOMETERS">Kilometers</option>
          <option value="MILES">Miles</option>
        </select>
      </div>

      <!-- Dark Mode -->
      <div class="form-field full-width dark-mode-field">
        <label class="field-label" for="darkModeToggle">Dark Mode</label>
        <label class="toggle-switch">
          <input type="checkbox" formControlName="darkMode" id="darkModeToggle" />
          <span class="slider"></span>
        </label>
      </div>
    </div>
  </div>

  <!-- Global Error -->
  @if (error; as message) {
    <div class="form-error">
      {{ message }}
    </div>
  }

  <!-- Actions -->
  <div class="form-actions">
    <tp-button
      type="submit"
      variant="primary"
      [disabled]="form.invalid || loading"
      [loading]="loading">
      {{ loading ? 'Saving...' : 'Save Changes' }}
    </tp-button>
    <tp-button
      type="button"
      variant="outline"
      (buttonClick)="onCancel()"
      [disabled]="loading">
      Cancel
    </tp-button>
  </div>
</form>
